<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Problem setups &mdash; sailfish 0.4.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Workflow patterns" href="workflow.html" />
    <link rel="prev" title="Sailfish" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> sailfish
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Problem setups</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#minimal-example">Minimal example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#required-methods">Required methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="#choosing-a-setup">Choosing a setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-parameters">Model parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optional-methods">Optional methods</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Workflow patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="kernels.html">Kernel libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">sailfish</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Problem setups</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/setups.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="problem-setups">
<h1>Problem setups<a class="headerlink" href="#problem-setups" title="Permalink to this headline"></a></h1>
<p>Simulations are configured by an object called a <cite>setup</cite>. The setup specifies
initial conditions, a mesh, boundary conditions, and a solver class, among
several other optional things. Setups can be specific test problems used for
code validation, or they can encompass whole classes of research problems,
with many internal parameters. The degrees of freedom within a setup are
called <cite>model parameters</cite>, and these have default values which define a
fiducial model, but they can also be overridden from command line input
or other sources of configuration.</p>
<div class="section" id="minimal-example">
<h2>Minimal example<a class="headerlink" href="#minimal-example" title="Permalink to this headline"></a></h2>
<p>Here is a minimal setup, which defines a 1D relativistic hydrodynamics problem
consisting of a traveling density wave:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">from</span> <span class="nn">sailfish.setup</span> <span class="kn">import</span> <span class="n">Setup</span>
<span class="kn">from</span> <span class="nn">sailfish.mesh</span> <span class="kn">import</span> <span class="n">PlanarCartesianMesh</span>

<span class="k">class</span> <span class="nc">DensityWave</span><span class="p">(</span><span class="n">Setup</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A sinusoidal variation of density propagating to the right.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">primitive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="c1"># gas density</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1"># velocity</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># gas pressure</span>

    <span class="k">def</span> <span class="nf">mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">PlanarCartesianMesh</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;srhd_1d&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;periodic&quot;</span>
</pre></div>
</div>
<p>This setup uses the <cite>srhd_1d</cite> solver (relativistic 1D hydrodynamics) with
cartesian coordinates, on a domain from 0.0 to 1.0. The boundary condition is
periodic, and the hydrodynamic primitive data so the density has a sinusoidal
variation, and the velocity is uniform.</p>
</div>
<div class="section" id="required-methods">
<h2>Required methods<a class="headerlink" href="#required-methods" title="Permalink to this headline"></a></h2>
<p>Custom setup classes must inherit the <a class="reference internal" href="_autosummary/sailfish.setup.Setup.html#sailfish.setup.Setup" title="sailfish.setup.Setup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Setup</span></code></a> base class.
The setup base class provides a lot of functionality in the form of methods
that have trivial default implementations, but can be overridden if needed.
The four methods implemented in the example above are required for the setup
to be instantiated (they are <cite>abstract</cite> methods in the base class).</p>
<p>The <a class="reference internal" href="_autosummary/sailfish.setup.Setup.html#sailfish.setup.Setup.primitive" title="sailfish.setup.Setup.primitive"><code class="xref py py-obj docutils literal notranslate"><span class="pre">primitive</span></code></a> method takes as arguments the
time, a coordinate position, and a slice of a primitive variable array
representing a single zone. The result is written to this slice rather than
returned from the function for efficiency reasons. Generally, the primitive
method is only used at the start of a new simulation, so the time will
typically be <cite>t=0.0</cite>. However, in the case of an inflow boundary condition,
the solver will also call the setup’s primitive method in the guard zones of
the mesh each time boundary conditions need to be applied. In other words, the
primitive method always serves as an initial condition, but it can also
provide a time-dependent Dirichlet boundary condition. The number and meaning
of primitive variables depends on the system being solved (the system is in
turn a property of the solver class, which is identified by the
<a class="reference internal" href="_autosummary/sailfish.setup.Setup.html#sailfish.setup.Setup.solver" title="sailfish.setup.Setup.solver"><code class="xref py py-obj docutils literal notranslate"><span class="pre">solver</span></code></a> property).</p>
<p>The object returned by the <a class="reference internal" href="_autosummary/sailfish.setup.Setup.html#sailfish.setup.Setup.mesh" title="sailfish.setup.Setup.mesh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mesh</span></code></a> method
describes the physical extent of the simulation domain, as well as how it is
discretized and what kind of coordinates are used (i.e. cartesian or
spherical). The <cite>mesh</cite> method accepts a <cite>resolution</cite> argument, the value of
which comes from the command line option <code class="code docutils literal notranslate"><span class="pre">--resolution</span> <span class="pre">|</span> <span class="pre">-n</span></code>, or the
<cite>resolution</cite> member of the <a class="reference internal" href="_autosummary/sailfish.driver.DriverArgs.html#sailfish.driver.DriverArgs" title="sailfish.driver.DriverArgs"><code class="xref py py-obj docutils literal notranslate"><span class="pre">DriverArgs</span></code></a> class. It
should be interpreted sensibly in the context of your setup to create a mesh
(for example no logical issues would arise if you were to ignore this argument
altogether, but don’t do that). For example if your setup uses a
<a class="reference internal" href="_autosummary/sailfish.mesh.LogSphericalMesh.html#sailfish.mesh.LogSphericalMesh" title="sailfish.mesh.LogSphericalMesh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LogSphericalMesh</span></code></a>, it makes sense to interpret
the <cite>resolution</cite> as the number of zones per decade in radius. If it’s a 2D
problem in spherical coordinates, it could mean the number of polar zones, or
in a 3D problem it could be the number of zones on each side of the domain.</p>
<p>The <a class="reference internal" href="_autosummary/sailfish.setup.Setup.html#sailfish.setup.Setup.boundary_condition" title="sailfish.setup.Setup.boundary_condition"><code class="xref py py-obj docutils literal notranslate"><span class="pre">boundary_condition</span></code></a> method returns
a string to identify the type of boundary condition to be applied. The mesh
and boundary condition objects must be compatible with (supported by) the
solver, otherwise the solver will throw an exception when it’s constructed.</p>
</div>
<div class="section" id="choosing-a-setup">
<h2>Choosing a setup<a class="headerlink" href="#choosing-a-setup" title="Permalink to this headline"></a></h2>
<p>The first argument to the sailfish command line tool is the name of a setup
class, converted to dash-case, i.e. you could run the setup above in a default
configuration by running <code class="code docutils literal notranslate"><span class="pre">sailfish</span> <span class="pre">density-wave</span></code>. The command line tool
will print the setup documentation to the terminal if invoked as
<code class="code docutils literal notranslate"><span class="pre">sailfish</span> <span class="pre">density-wave</span> <span class="pre">--describe</span></code>. It’s good practice to give your
setup class an accurate doc string.</p>
<p>Setup sub-classes are automatically discovered when sailfish is imported or
run from the command line. However to be found, the module containing your
class must be imported before <a class="reference internal" href="_autosummary/sailfish.driver.simulate.html#sailfish.driver.simulate" title="sailfish.driver.simulate"><code class="xref py py-obj docutils literal notranslate"><span class="pre">driver.simulate</span></code></a> is called. If you add a
new source file to the <a class="reference internal" href="_autosummary/sailfish.setups.html#module-sailfish.setups" title="sailfish.setups"><code class="xref py py-obj docutils literal notranslate"><span class="pre">setups</span></code></a> module, you must import that module in
the <code class="code docutils literal notranslate"><span class="pre">setups/__init__.py</span></code> file for the setup class(es) in it to be
discovered.</p>
</div>
<div class="section" id="model-parameters">
<h2>Model parameters<a class="headerlink" href="#model-parameters" title="Permalink to this headline"></a></h2>
<p>A setup can have internal degrees of freedom to be configured at runtime,
which are referred to as <cite>model parameters</cite>. To add a model parameter to a
setup, just define it as a class variable using the <a class="reference internal" href="_autosummary/sailfish.setup.Parameter.html#sailfish.setup.Parameter" title="sailfish.setup.Parameter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">param</span></code></a> constructor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sailfish.setup</span> <span class="kn">import</span> <span class="n">Setup</span><span class="p">,</span> <span class="n">param</span>

<span class="k">class</span> <span class="nc">DensityWave</span><span class="p">(</span><span class="n">Setup</span><span class="p">):</span>
    <span class="n">wavenumber</span> <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;integer wavenumber of the sinusoid&quot;</span><span class="p">)</span>
    <span class="n">velocity</span> <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;speed of the wave&quot;</span><span class="p">)</span>

    <span class="c1"># ...</span>
</pre></div>
</div>
<p>The two positional arguments to <a class="reference internal" href="_autosummary/sailfish.setup.Parameter.html#sailfish.setup.Parameter" title="sailfish.setup.Parameter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">param</span></code></a> are a default value
(from which the parameter type is inferred), and a help message. An optional
keyword argument <code class="code docutils literal notranslate"><span class="pre">mutable=True</span></code> can be supplied to indicate that a
parameter can be changed in a restarted run from its initial value. For the
model parameters that only influence the initial condition, it doesn’t make
sense to make them mutable.</p>
<p>Model parameters are passed to the setup class from the command line as
key-value pairs like this:
<code class="code docutils literal notranslate"><span class="pre">sailfish</span> <span class="pre">density-wave</span> <span class="pre">--model</span> <span class="pre">amplitude=0.5</span> <span class="pre">wavenumber=2</span></code>.</p>
</div>
<div class="section" id="optional-methods">
<h2>Optional methods<a class="headerlink" href="#optional-methods" title="Permalink to this headline"></a></h2>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Sailfish" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="workflow.html" class="btn btn-neutral float-right" title="Workflow patterns" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Jonathan Zrake.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>